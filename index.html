<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="lrm-valhalla/leaflet.routing.valhalla.css">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="css/app.css">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-4">
                <div class="houses">
                    <div class="input-group">
                      <input type="text" class="address-input form-control" aria-label="..." onkeypress="AddressInput.getAddress(event)" title="address">
                      <div class="input-group-btn">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Choose <span class="caret"></span></button>
                        <ul class="dropdown-menu">
                        </ul>
                      </div><!-- /btn-group -->
                    </div><!-- /input-group -->

                    <div class="input-group">
                      <input type="text" class="address-input form-control" aria-label="..." onkeypress="AddressInput.getAddress(event)" title="address">
                      <div class="input-group-btn">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Choose <span class="caret"></span></button>
                        <ul class="dropdown-menu">
                        </ul>
                      </div><!-- /btn-group -->
                    </div><!-- /input-group -->

                    <div class="input-group">
                      <input type="text" class="address-input form-control" aria-label="..." onkeypress="AddressInput.getAddress(event)" title="address">
                      <div class="input-group-btn">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Choose <span class="caret"></span></button>
                        <ul class="dropdown-menu">
                        </ul>
                      </div><!-- /btn-group -->
                    </div><!-- /input-group -->
                </div>
                <button type="button" class="btn btn-default btn-lg" onclick="AddressInput.addHouse()">+</button>
                <button type="button" class="btn btn-primary btn-lg" onclick="AddressInput.getRoute()">Route!</button>
            </div>
            <div class="col-md-8">
                <div id="map"></div>
            </div>
        </div>
    </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="lrm/leaflet-routing-machine.min.js"></script>
    <script src="lrm-valhalla/lrm-valhalla.js"></script>
    <script src="js/app.js"></script>
    <script>
        var addressSource = function (requestString, responseFunc) {
            console.log(requestString);
            var queryString = requestString.term.replace(/[^0-9a-zA-Z ]/g, '');

            $.ajax({
                url: 'https://search.mapzen.com/v1/autocomplete',
                dataType: 'json',
                data: {
                    'text': queryString,
                    'api_key': 'search-WE7i6v8',
                    'focus.point.lat': '37.338',
                    'focus.point.lon': '-121.886',
                },
                success: function (data) {
                    var arr = [];
                    data.features.forEach(function(feature) {
                        arr.push({
                            label: feature.properties.label,
                            value: feature.properties.label,
                            coords: feature.geometry.coordinates.reverse()
                        });
                    });

                    responseFunc(arr);
                },
                error: function (jqXHR, status, error) {
                    console.log(error);
                }
            });
        }
        $(function(){
            $('input').autocomplete({
                minLength: 5,
                source: addressSource,
                select: function (event, ui) {

                }
            });
        });
    </script>
    <script>
        var map = L.map('map').setView([37.338, -121.886], 15);
		var OpenStreetMap_Mapnik = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 19,
			attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
		});
        OpenStreetMap_Mapnik.addTo(map);
        var route = L.Routing.control({
            waypoints: [
                // L.Routing.waypoint([41.8758,-87.6189], 'Home'),
                // L.Routing.waypoint([33.8128,-117.9259], "Mom's")
            ],
            router: L.Routing.valhalla('valhalla-xy4lCOo', 'auto'),
            formatter: new L.Routing.Valhalla.Formatter(),
            summaryTemplate:'<div class="start">{name}</div><div class="info {transitmode}">{distance}, {time}</div>' +
                            '<button id="button">Click me</button>'
        });

        route.addTo(map);
    </script>
</body>
</html>