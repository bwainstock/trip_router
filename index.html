<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="lrm-valhalla/leaflet.routing.valhalla.css">

    <style>
      html, body {
        height: 100%;
      }
      #map {
        height: 600px;
        width: 100%;
        margin: 0;
        padding: 0;
      }
      .geocode-address {
        padding: 0 10px;
      }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-4">
                <div class="input-group">
                  <input type="text" class="address-input form-control" id="input-1" aria-label="..." onkeypress="getAddress(event)">
                  <div class="input-group-btn">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Choose <span class="caret"></span></button>
                    <ul class="dropdown-menu">
                    </ul>
                  </div><!-- /btn-group -->
                </div><!-- /input-group -->

                <div class="input-group">
                  <input type="text" class="address-input form-control" id="input-2" aria-label="..." onkeypress="getAddress(event)">
                  <div class="input-group-btn">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Choose <span class="caret"></span></button>
                    <ul class="dropdown-menu">
                    </ul>
                  </div><!-- /btn-group -->
                </div><!-- /input-group -->

                <div class="input-group">
                  <input type="text" class="address-input form-control" id="input-3" aria-label="..." onkeypress="getAddress(event)">
                  <div class="input-group-btn">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Choose <span class="caret"></span></button>
                    <ul class="dropdown-menu">
                    </ul>
                  </div><!-- /btn-group -->
                </div><!-- /input-group -->                                
            </div>
            <div class="col-md-8">
                <div id="map"></div>
            </div>
        </div>
    </div>
    

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
    <script src="js/leaflet.js"></script>
    <script src="lrm/leaflet-routing-machine.min.js"></script>
    <script src="lrm-valhalla/lrm-valhalla.js"></script>
    <script>
        var houses = {};

        function getAddress(e) {
            if (e.keyCode == 13) {
                var searchTerm = e.srcElement.value;
                $.ajax({
                    url: 'https://search.mapzen.com/v1/search',
                    dataType: 'json',
                    data: {
                        "text": searchTerm,
                        "api_key": "search-WE7i6v8",
                        "size": "3",
                        "boundary.circle.lat": "37.338",
                        "boundary.circle.lon": "-121.886",
                        "boundary.circle.radius": "50"
                    },
                    success: function (data, success, jqXHR) {
                        $dropdownMenu = $(e.srcElement.nextElementSibling).find('.dropdown-menu');
                        data.features.forEach(function(feature, i) { 
                            $dropdownMenu.append( '<li class="geocode-address" data='+feature.geometry.coordinates.reverse()+'>'+feature.properties.label+' '+feature.properties.postalcode+'</li>' );
                            if (i+1 !== data.features.length) {
                                $dropdownMenu.append( '<li class="divider"></li>' )
                            }
                        });
                        $('.geocode-address').click(function(e) {
                            bar = this;
                            var lat = $(e.currentTarget).attr('data').split(',')[0],
                                lng = $(e.currentTarget).attr('data').split(',')[1],
                                address = $(this).text();
                            $(this).parents('.input-group-btn').prev('.address-input').val(address)
                            houses[address] = {'lat': lat, 'lng': lng};
                        });
                        $(e.srcElement.nextElementSibling.firstElementChild).dropdown('toggle');
                        foo = data;
                        console.log(data);
                    },
                    error: function (jqXHR, status, error) {
                        console.log(error);
                    }
                });
            }
        }



        var map = L.map('map').setView([37.338, -121.886], 15);
		var OpenStreetMap_Mapnik = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 19,
			attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
		});
        OpenStreetMap_Mapnik.addTo(map);
        var route = L.Routing.control({
            waypoints: [
                // L.Routing.waypoint([41.8758,-87.6189], 'Home'),
                // L.Routing.waypoint([33.8128,-117.9259], "Mom's")
            ],
            router: L.Routing.valhalla('valhalla-xy4lCOo', 'auto'),
            formatter: new L.Routing.Valhalla.Formatter(),
            summaryTemplate:'<div class="start">{name}</div><div class="info {transitmode}">{distance}, {time}</div>' +
                            '<button id="button">Click me</button>'

        });

        route.addTo(map);
    </script>
</body>
</html>